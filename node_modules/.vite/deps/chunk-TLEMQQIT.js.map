{
  "version": 3,
  "sources": ["../../amis-ui/esm/components/Editor.js"],
  "sourcesContent": ["/**\n * amis-ui v3.6.3\n * Copyright 2018-2023 fex\n */\n\nimport { __extends, __assign, __decorate, __metadata } from 'tslib';\nimport React__default from 'react';\nimport { autobind, themeable, localeable } from 'amis-core';\nimport { Icon } from './icons.js';\n\n/**\n * @file Editor\n * @description\n * @author fex\n */\n// 用于发布 sdk 版本的时候替换，因为不确定 sdk 版本怎么部署，而 worker 地址路径不可知。\n// 所以会被 fis3 替换成取相对的代码。\nfunction filterUrl(url) {\n    return url;\n}\nif (!window.MonacoEnvironment) {\n    window.MonacoEnvironment = {\n        getWorkerUrl: function (moduleId, label) {\n            var url = '/pkg/editor.worker.js';\n            if (label === 'json') {\n                url = '/pkg/json.worker.js';\n            }\n            else if (label === 'css') {\n                url = '/pkg/css.worker.js';\n            }\n            else if (label === 'html') {\n                url = '/pkg/html.worker.js';\n            }\n            else if (label === 'typescript' || label === 'javascript') {\n                url = '/pkg/ts.worker.js';\n            }\n            url = filterUrl(url);\n            // url 有可能会插件替换成 cdn 地址，比如：fis3-prepackager-stand-alone-pack\n            if (/^https?/.test(url)) {\n                return \"data:text/javascript;charset=utf-8,\".concat(encodeURIComponent(\"\\n        importScripts('\".concat(url, \"');\")), \"\\n      \");\n            }\n            return url;\n        }\n    };\n}\nfunction monacoFactory(containerElement, monaco, options) {\n    return monaco.editor.create(containerElement, __assign({ 'autoIndent': true, 'formatOnType': true, 'formatOnPaste': true, 'selectOnLineNumbers': true, 'scrollBeyondLastLine': false, 'folding': true, 'minimap': {\n            enabled: false\n        }, 'scrollbar': {\n            alwaysConsumeMouseWheel: false\n        }, 'bracketPairColorization.enabled': true }, options));\n}\nvar Editor = /** @class */ (function (_super) {\n    __extends(Editor, _super);\n    function Editor(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            isFullscreen: false,\n            innerWidth: 'auto',\n            innerHeight: 'auto'\n        };\n        _this.disposes = [];\n        _this.wrapperRef = _this.wrapperRef.bind(_this);\n        _this.currentValue = props.value;\n        return _this;\n    }\n    Editor.prototype.componentDidUpdate = function (prevProps) {\n        var _a, _b;\n        if (this.props.value !== this.currentValue &&\n            this.editor &&\n            !this.props.isDiffEditor) {\n            var value = String(this.props.value);\n            if (this.props.language === 'json') {\n                try {\n                    value = JSON.stringify(JSON.parse(value), null, 2);\n                }\n                catch (e) { }\n            }\n            this.preventTriggerChangeEvent = true;\n            var eidtor = this.editor.getModifiedEditor\n                ? this.editor.getModifiedEditor()\n                : this.editor;\n            var model = eidtor.getModel();\n            eidtor.pushUndoStop();\n            // pushEditOperations says it expects a cursorComputer, but doesn't seem to need one.\n            model.pushEditOperations([], [\n                {\n                    range: model.getFullModelRange(),\n                    text: value\n                }\n            ]);\n            eidtor.pushUndoStop();\n            this.preventTriggerChangeEvent = false;\n        }\n        if (this.props.options.readOnly !== prevProps.options.readOnly &&\n            this.editor) {\n            (_b = (_a = this.editor).updateOptions) === null || _b === void 0 ? void 0 : _b.call(_a, this.props.options);\n        }\n    };\n    Editor.prototype.componentWillUnmount = function () {\n        var _a;\n        if (this.editor) {\n            var context = this.props.context || window;\n            var monaco = context.monaco || window.monaco;\n            var editorWillUnmount = this.props.editorWillUnmount;\n            editorWillUnmount && editorWillUnmount(this.editor, monaco);\n        }\n        this.disposes.forEach(function (_a) {\n            var dispose = _a.dispose;\n            return dispose();\n        });\n        this.disposes = [];\n        (_a = this.editor) === null || _a === void 0 ? void 0 : _a.dispose();\n    };\n    Editor.prototype.wrapperRef = function (ref) {\n        this.container = ref;\n        if (ref) {\n            this.loadMonaco();\n        }\n        else {\n            try {\n                this.disposes.forEach(function (_a) {\n                    var dispose = _a.dispose;\n                    return dispose();\n                });\n                this.disposes = [];\n                if (this.editor) {\n                    this.editor.getModel().dispose();\n                    this.editor.dispose();\n                }\n                this.editor = null;\n            }\n            catch (e) {\n                // ignore\n            }\n        }\n    };\n    Editor.prototype.loadMonaco = function () {\n        var _this = this;\n        import('monaco-editor').then(function (monaco) { return _this.initMonaco(monaco); });\n    };\n    Editor.prototype.initMonaco = function (monaco) {\n        var _a, _b;\n        var value = this.props.value !== null ? this.props.value : this.props.defaultValue;\n        var _c = this.props, language = _c.language, editorTheme = _c.editorTheme, options = _c.options, editorFactory = _c.editorFactory;\n        var containerElement = this.container;\n        if (!containerElement) {\n            return;\n        }\n        // Before initializing monaco editor\n        this.editorWillMount(monaco);\n        if (this.props.language === 'json') {\n            try {\n                value = JSON.stringify(typeof value === 'string' ? JSON.parse(value) : value, null, 2);\n            }\n            catch (e) {\n                // ignore\n            }\n        }\n        var factory = editorFactory || monacoFactory;\n        this.editor = factory(containerElement, monaco, __assign(__assign({}, options), { automaticLayout: true, value: value, language: language, editorTheme: editorTheme, theme: editorTheme }));\n        // json 默认开启验证。\n        (_a = monaco.languages.json) === null || _a === void 0 ? void 0 : _a.jsonDefaults.setDiagnosticsOptions(__assign({ enableSchemaRequest: true, validate: true, allowComments: true }, (_b = monaco.languages.json) === null || _b === void 0 ? void 0 : _b.jsonDefaults.diagnosticsOptions));\n        // After initializing monaco editor\n        this.editorDidMount(this.editor, monaco);\n    };\n    Editor.prototype.editorWillMount = function (monaco) {\n        var editorWillMount = this.props.editorWillMount;\n        editorWillMount && editorWillMount(monaco);\n    };\n    Editor.prototype.editorDidMount = function (editor, monaco) {\n        var _this = this;\n        var _a, _b, _c;\n        var _d = this.props, editorDidMount = _d.editorDidMount, onChange = _d.onChange, onFocus = _d.onFocus, onBlur = _d.onBlur;\n        editorDidMount && editorDidMount(editor, monaco);\n        editor.onDidChangeModelContent &&\n            this.disposes.push(editor.onDidChangeModelContent(function (event) {\n                var value = editor.getValue();\n                // Always refer to the latest value\n                _this.currentValue = value;\n                // Only invoking when user input changed\n                if (!_this.preventTriggerChangeEvent && onChange) {\n                    onChange(value, event);\n                }\n            }));\n        onFocus &&\n            editor.onDidFocusEditorWidget &&\n            this.disposes.push(editor.onDidFocusEditorWidget(onFocus));\n        onBlur &&\n            editor.onDidBlurEditorWidget &&\n            this.disposes.push(editor.onDidBlurEditorWidget(onBlur));\n        var _e = (_c = (_b = (_a = this === null || this === void 0 ? void 0 : this.editor) === null || _a === void 0 ? void 0 : _a._configuration) === null || _b === void 0 ? void 0 : _b._elementSizeObserver) !== null && _c !== void 0 ? _c : {}, _f = _e.width, width = _f === void 0 ? 'auto' : _f, _g = _e.height, height = _g === void 0 ? 'auto' : _g;\n        this.setState({ innerHeight: height, innerWidth: width });\n    };\n    Editor.prototype.handleFullscreenModeChange = function () {\n        var _this = this;\n        this.setState({ isFullscreen: !this.state.isFullscreen }, function () {\n            // 退出全屏模式后需要resize一下editor的宽高，避免溢出父元素\n            return !_this.state.isFullscreen &&\n                _this.editor.layout({\n                    width: _this.state.innerWidth,\n                    height: _this.state.innerHeight\n                });\n        });\n    };\n    Editor.prototype.render = function () {\n        var _a = this.props, className = _a.className, width = _a.width, height = _a.height, __ = _a.translate, placeholder = _a.placeholder, cx = _a.classnames, value = _a.value;\n        var style = __assign({}, (this.props.style || {}));\n        style.width = width;\n        style.height = height;\n        return (React__default.createElement(\"div\", { className: cx(\"MonacoEditor\", { 'is-fullscreen': this.state.isFullscreen }, className), style: style, ref: this.wrapperRef },\n            this.editor && placeholder && !value ? (React__default.createElement(\"span\", { className: cx('MonacoEditor-placeholder') }, placeholder)) : null,\n            this.editor && this.props.allowFullscreen ? (React__default.createElement(\"div\", { className: cx(\"MonacoEditor-header\") },\n                React__default.createElement(\"a\", { className: cx('Modal-close', \"MonacoEditor-fullscreen\"), \"data-tooltip\": this.state.isFullscreen\n                        ? __('Editor.exitFullscreen')\n                        : __('Editor.fullscreen'), \"data-position\": \"left\", onClick: this.handleFullscreenModeChange },\n                    React__default.createElement(Icon, { icon: this.state.isFullscreen ? 'compress-alt' : 'expand-alt', className: \"icon\" })))) : null));\n    };\n    Editor.defaultProps = {\n        language: 'javascript',\n        editorTheme: 'vs',\n        width: '100%',\n        height: '100%',\n        allowFullscreen: false,\n        options: {}\n    };\n    __decorate([\n        autobind,\n        __metadata(\"design:type\", Function),\n        __metadata(\"design:paramtypes\", []),\n        __metadata(\"design:returntype\", void 0)\n    ], Editor.prototype, \"handleFullscreenModeChange\", null);\n    return Editor;\n}(React__default.Component));\nvar Editor$1 = themeable(localeable(Editor));\n\nexport { Editor, Editor$1 as default, monacoFactory };\n"],
  "mappings": "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",
  "names": ["Editor", "_a", "React__default"]
}
